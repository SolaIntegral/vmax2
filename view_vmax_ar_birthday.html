<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>🎂 パパへの誕生日プレゼント — VMAX AR</title>
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    <style>
      html,body{height:100%;margin:0;background:#111;font-family:'Hiragino Sans','ヒラギノ角ゴシック',sans-serif;overflow:hidden;}
      
      /* Lock Screen Styles - Elegant Birthday Design */
      .lock-screen{
        position:fixed;
        top:0;left:0;
        width:100%;height:100%;
        background:linear-gradient(135deg,#2c3e50 0%,#34495e 50%,#2c3e50 100%);
        background-size:400% 400%;
        animation:gradientShift 8s ease infinite;
        display:flex;
        flex-direction:column;
        justify-content:center;
        align-items:center;
        z-index:1000;
        transition:all 0.8s cubic-bezier(0.4,0,0.2,1);
      }
      .lock-screen.hidden{
        opacity:0;
        visibility:hidden;
        transform:scale(0.9);
      }
      
      .lock-title{
        color:#f8f9fa;
        font:28px/1.4 'Hiragino Sans','ヒラギノ角ゴシック',sans-serif;
        font-weight:300;
        text-align:center;
        margin-bottom:20px;
        text-shadow:0 2px 8px rgba(0,0,0,0.3);
        letter-spacing:1px;
      }
      
      .lock-subtitle{
        color:rgba(248,249,250,0.85);
        font:16px/1.6 'Hiragino Sans','ヒラギノ角ゴシック',sans-serif;
        font-weight:300;
        text-align:center;
        margin-bottom:60px;
        text-shadow:0 1px 3px rgba(0,0,0,0.2);
        max-width:300px;
      }
      
      .lock-key{
        width:140px;height:140px;
        background:rgba(255,255,255,0.95);
        border-radius:20px;
        display:flex;
        justify-content:center;
        align-items:center;
        cursor:pointer;
        box-shadow:0 8px 32px rgba(0,0,0,0.3),inset 0 1px 0 rgba(255,255,255,0.8);
        transition:all 0.4s cubic-bezier(0.4,0,0.2,1);
        animation:gentleFloat 4s ease-in-out infinite;
        border:1px solid rgba(255,255,255,0.2);
        position:relative;
      }
      
      .lock-key img{
        width:80px;height:80px;
        opacity:0.9;
        transition:all 0.3s ease;
        object-fit:contain;
        filter:drop-shadow(0 2px 8px rgba(0,0,0,0.2));
      }
      
      .lock-key:hover{
        transform:translateY(-5px) scale(1.05);
        box-shadow:0 12px 40px rgba(0,0,0,0.4),inset 0 1px 0 rgba(255,255,255,0.9);
        background:rgba(255,255,255,1);
      }
      
      .lock-key:hover img{
        opacity:1;
        transform:scale(1.1);
      }
      
      .lock-key:active{
        transform:translateY(-2px) scale(1.02);
      }
      
      .lock-hint{
        color:rgba(248,249,250,0.7);
        font:14px/1.4 'Hiragino Sans','ヒラギノ角ゴシック',sans-serif;
        font-weight:300;
        text-align:center;
        margin-top:40px;
        animation:subtlePulse 3s ease-in-out infinite;
      }
      
      @keyframes gentleFloat{
        0%,100%{transform:translateY(0px);}
        50%{transform:translateY(-8px);}
      }
      
      @keyframes gradientShift{
        0%{background-position:0% 50%;}
        50%{background-position:100% 50%;}
        100%{background-position:0% 50%;}
      }
      
      @keyframes subtlePulse{
        0%,100%{opacity:0.7;}
        50%{opacity:1;}
      }
      
      @keyframes pulse{
        0%,100%{opacity:0.7;}
        50%{opacity:1;}
      }
      
      @keyframes sparkleFloat{
        0%{opacity:1;transform:translateY(0px) scale(0.5);}
        50%{opacity:1;transform:translateY(-30px) scale(1);}
        100%{opacity:0;transform:translateY(-60px) scale(0.5);}
      }
      
      @keyframes elegantFloat{
        0%{opacity:0;transform:translateY(10px) scale(0.3);}
        20%{opacity:1;transform:translateY(0px) scale(1);}
        80%{opacity:1;transform:translateY(-20px) scale(0.8);}
        100%{opacity:0;transform:translateY(-40px) scale(0.3);}
      }
      
      /* Model Viewer Styles */
      model-viewer{
        width:100%;
        height:100%;
        z-index:-1;
        transition:z-index 0.1s ease 0.8s;
        --progress-bar-color:#ffd700;
      }
      
      model-viewer.show{
        z-index:1;
      }
      
      /* AR Content Styles */
      .ar-content{
        opacity:0;
        z-index:-1;
        transition:opacity 1s ease-in-out 0.5s, z-index 0.1s ease 0.8s;
      }
      .ar-content.show{
        opacity:1;
        z-index:10;
      }
      
      .birthday-message{
        position:fixed;
        right:15px;top:15px;
        background:linear-gradient(135deg,#ff6b6b,#feca57);
        padding:20px 25px;
        border-radius:20px;
        color:#fff;
        font:18px/1.4 'Hiragino Sans','ヒラギノ角ゴシック',sans-serif;
        box-shadow:0 6px 20px rgba(255,107,107,0.4);
        animation:messageFloat 4s ease-in-out infinite;
        text-align:center;
        max-width:280px;
      }
      
      @keyframes messageFloat{
        0%,100%{transform:translateY(0px);}
        50%{transform:translateY(-8px);}
      }
      
      
      .instructions{
        position:fixed;
        left:15px;bottom:15px;
        background:rgba(255,255,255,0.95);
        padding:15px 20px;
        border-radius:15px;
        color:#333;
        font:14px/1.4 'Hiragino Sans','ヒラギノ角ゴシック',sans-serif;
        max-width:220px;
        box-shadow:0 4px 15px rgba(0,0,0,0.2);
        z-index:10;
      }
      
      .credit{
        position:fixed;
        left:15px;top:15px;
        color:#ccc;
        font:12px/1.4 'Hiragino Sans','ヒラギノ角ゴシック',sans-serif;
        opacity:0.8;
        max-width:250px;
      }
      
      .credit a{color:#aaa;}
    </style>
  </head>
  <body>
    <!-- Lock Screen -->
    <div class="lock-screen" id="lockScreen">
      <div class="lock-title">お誕生日おめでとう</div>
      <div class="lock-subtitle">
        パパへ<br>
        ずっと欲しがってたVmaxのAR体験を用意したよ！<br>
      </div>
      <div class="lock-key" id="unlockKey">
        <img src="key.png" alt="鍵" onerror="this.style.display='none'; this.parentNode.innerHTML='🔑'; this.parentNode.style.fontSize='60px';">
      </div>
      <div class="lock-hint">鍵に触れて見てね</div>
    </div>

    <!-- AR Content (initially hidden) -->
    <div class="ar-content" id="arContent">
      <div class="birthday-message">
        🎂 パパ、誕生日おめでとう！🎉<br>
        これからもよろしくね！✨<br>
      </div>

      <div class="instructions">
        📱 <strong>操作方法</strong><br>
        • スマホを動かして360度見回そう<br>
        • ピンチで拡大・縮小<br>
        • ドラッグで回転<br>
        • model-viewerのARボタンで現実空間に配置
      </div>

      <div class="credit">
        "V Max-on- Road- Onjaaninoja_bridge" (TG13730, CC-BY-4.0) をベースに作成
      </div>
    </div>


    <!-- Model Viewer (always visible, controlled by z-index) -->
    <model-viewer id="mv"
      poster="poster.png"
      src="vmax_bike_only_v2_black.glb"
      ios-src="vmax_bike_only_v2_black.usdz"
      camera-controls
      ar ar-modes="scene-viewer quick-look webxr"
      ar-scale="fixed"
      camera-orbit="0deg 75deg 3m"
      min-camera-orbit="auto auto 2m"
      max-camera-orbit="auto auto 6m"
      camera-target="0m 0m 0m"
      field-of-view="30deg"
      exposure="1.2"
      shadow-intensity="1">
    </model-viewer>

    <script>
      // Unlock functionality with elegant animations
      document.getElementById('unlockKey').addEventListener('click', function() {
        const lockScreen = document.getElementById('lockScreen');
        const arContent = document.getElementById('arContent');
        const modelViewer = document.getElementById('mv');
        
        // Add subtle click animation
        this.style.transform = 'translateY(-2px) scale(0.98)';
        this.style.boxShadow = '0 4px 20px rgba(0,0,0,0.4)';
        
        // Create gentle celebration effects
        for(let i = 0; i < 6; i++) {
          setTimeout(() => {
            createElegantSparkle();
          }, i * 200);
        }
        
        setTimeout(() => {
          // Hide lock screen with smooth animation
          lockScreen.classList.add('hidden');
          
          // Show AR content and model viewer after lock screen animation completes
          setTimeout(() => {
            arContent.classList.add('show');
            modelViewer.classList.add('show');
          }, 400);
        }, 600);
      });

      // Elegant hover effects on key
      const key = document.getElementById('unlockKey');
      key.addEventListener('mouseenter', function() {
        // Create subtle sparkles around the key
        for(let i = 0; i < 4; i++) {
          setTimeout(() => {
            createSubtleSparkle(this);
          }, i * 300);
        }
      });

      // Create subtle sparkles around the key on hover
      function createSubtleSparkle(element) {
        const sparkle = document.createElement('div');
        sparkle.innerHTML = '✦';
        sparkle.style.position = 'fixed';
        sparkle.style.fontSize = '16px';
        sparkle.style.color = 'rgba(255,255,255,0.6)';
        sparkle.style.pointerEvents = 'none';
        sparkle.style.zIndex = '1001';
        sparkle.style.animation = 'elegantFloat 2.5s ease-out forwards';
        
        const rect = element.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;
        const angle = Math.random() * 360;
        const distance = 60 + Math.random() * 30;
        
        sparkle.style.left = (centerX + Math.cos(angle) * distance) + 'px';
        sparkle.style.top = (centerY + Math.sin(angle) * distance) + 'px';
        
        document.body.appendChild(sparkle);
        
        setTimeout(() => {
          if(document.body.contains(sparkle)) {
            document.body.removeChild(sparkle);
          }
        }, 2500);
      }

      // Create elegant celebration sparkles when unlocking
      function createElegantSparkle() {
        const sparkle = document.createElement('div');
        const sparkles = ['✦', '✧', '⋆', '✩', '✪'];
        sparkle.innerHTML = sparkles[Math.floor(Math.random() * sparkles.length)];
        sparkle.style.position = 'fixed';
        sparkle.style.fontSize = (14 + Math.random() * 8) + 'px';
        sparkle.style.color = 'rgba(255,255,255,' + (0.4 + Math.random() * 0.4) + ')';
        sparkle.style.pointerEvents = 'none';
        sparkle.style.zIndex = '1001';
        sparkle.style.left = (window.innerWidth * 0.2 + Math.random() * window.innerWidth * 0.6) + 'px';
        sparkle.style.top = (window.innerHeight * 0.1 + Math.random() * window.innerHeight * 0.8) + 'px';
        sparkle.style.animation = 'elegantFloat 4s ease-out forwards';
        
        document.body.appendChild(sparkle);
        
        setTimeout(() => {
          if(document.body.contains(sparkle)) {
            document.body.removeChild(sparkle);
          }
        }, 4000);
      }

      // Add touch feedback for mobile devices
      key.addEventListener('touchstart', function(e) {
        e.preventDefault();
        this.style.transform = 'scale(0.95)';
      });

      key.addEventListener('touchend', function(e) {
        e.preventDefault();
        this.click();
      });

      // Prevent double-tap zoom on mobile
      let lastTouchEnd = 0;
      document.addEventListener('touchend', function(event) {
        const now = (new Date()).getTime();
        if (now - lastTouchEnd <= 300) {
          event.preventDefault();
        }
        lastTouchEnd = now;
      }, false);

      // Simple model viewer logging
      const modelViewer = document.getElementById('mv');
      console.log('Model viewer initialized');
      console.log('GLB source:', modelViewer.src);
      
      // Check key image loading
      const keyImg = document.querySelector('.lock-key img');
      if (keyImg) {
        keyImg.onload = function() {
          console.log('Key image loaded successfully');
        };
        keyImg.onerror = function() {
          console.error('Key image failed to load');
          console.log('Fallback to emoji key');
        };
        console.log('Key image source:', keyImg.src);
      }
      
      // Handle successful load
      modelViewer.addEventListener('load', function() {
        console.log('Model loaded successfully');
      });

      // Handle errors
      modelViewer.addEventListener('error', function(event) {
        console.error('Model loading error:', event.detail);
      });
    </script>
  </body>
</html>
